(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{11:function(e,t,s){},13:function(e,t,s){},14:function(e,t,s){"use strict";s.r(t);var a=s(4),c=s.n(a),i=s(1),n=(s(9),s(10),s(11),s(2)),l=s.n(n),d=s(0);const o=e=>{let{posts:t,selectedPost:s,setSelectedPost:a}=e;return Object(d.jsxs)("div",{"data-cy":"PostsList",children:[Object(d.jsx)("p",{className:"title",children:"Posts:"}),Object(d.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{className:"has-background-link-light",children:[Object(d.jsx)("th",{children:"#"}),Object(d.jsx)("th",{children:"Title"}),Object(d.jsx)("th",{children:" "})]})}),Object(d.jsx)("tbody",{children:t.map((e=>Object(d.jsxs)("tr",{"data-cy":"Post",children:[Object(d.jsx)("td",{"data-cy":"PostId",children:e.id}),Object(d.jsx)("td",{"data-cy":"PostTitle",children:e.title}),Object(d.jsx)("td",{className:"has-text-right is-vcentered",children:Object(d.jsx)("button",{type:"button","data-cy":"PostButton",className:l()("button is-link",{"is-light":(null===s||void 0===s?void 0:s.id)!==e.id}),onClick:()=>(e=>{(null===s||void 0===s?void 0:s.id)===e.id?a(null):a(e)})(e),children:(null===s||void 0===s?void 0:s.id)===e.id?"Close":"Open"})})]},e.id)))})]})]})};s(13);const r=()=>Object(d.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(d.jsx)("div",{className:"Loader__content"})}),j=e=>{let{handleCreateComment:t,isCommentLoading:s}=e;const[a,c]=Object(i.useState)({name:"",body:"",email:""}),[n,o]=Object(i.useState)(!1),[r,j]=Object(i.useState)(!1),[m,b]=Object(i.useState)(!1),h=e=>{e.preventDefault();const s=a.name.trim(),i=a.email.trim(),n=a.body.trim();s&&i&&n?(t(a),c((e=>({...e,body:""})))):(s||o(!0),i||j(!0),n||b(!0))};return Object(d.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:e=>h(e),children:[Object(d.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:"Name Surname",className:l()("input",{"is-danger":n}),value:a.name,onChange:e=>(e=>{o(!1),c((t=>({...t,name:e.target.value})))})(e)}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-user"})}),Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:n&&Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),n&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(d.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(d.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",className:l()("input",{"is-danger":r}),value:a.email,onChange:e=>(e=>{j(!1),c((t=>({...t,email:e.target.value})))})(e)}),Object(d.jsx)("span",{className:"icon is-small is-left",children:Object(d.jsx)("i",{className:"fas fa-envelope"})}),Object(d.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:r&&Object(d.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),r&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(d.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(d.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",className:l()("textarea",{"is-danger":m}),value:a.body,onChange:e=>(e=>{b(!1),c((t=>({...t,body:e.target.value})))})(e)})}),m&&Object(d.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(d.jsxs)("div",{className:"field is-grouped",children:[Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"submit",className:l()("button","is-link",{"is-loading":s}),children:"Add"})}),Object(d.jsx)("div",{className:"control",children:Object(d.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:()=>{c({name:"",body:"",email:""})},children:"Clear"})})]})]})},m="https://mate.academy/students-api";function b(e){return new Promise((t=>{setTimeout(t,e)}))}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a={method:t};s&&(a.body=JSON.stringify(s),a.headers={"Content-Type":"application/json; charset=UTF-8"});const[c]=await Promise.all([fetch(m+e,a),b(300)]);return c.ok?c.json():Promise.reject()}const O=e=>h(e),u=(e,t)=>h(e,"POST",t),x=e=>h(e,"DELETE"),y=e=>{let{post:t}=e;const[s,a]=Object(i.useState)([]),[c,n]=Object(i.useState)(!0),[l,o]=Object(i.useState)(!1),[m,b]=Object(i.useState)(!1),[h,y]=Object(i.useState)(!1),N=Object(i.useCallback)((async()=>{n(!0);try{o(!1);const s=await(e=t.id,O("/comments?postId=".concat(e)));a(s)}catch{o(!0)}finally{n(!1)}var e}),[t.id]),p=e=>{try{(e=>{x("/comments/".concat(e))})(e),a((t=>t.filter((t=>t.id!==e))))}catch(t){console.error("Error deleting comment: ".concat(t))}};return Object(i.useEffect)((()=>{N(),b(!1)}),[N,t.id]),Object(d.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(d.jsxs)("div",{className:"block",children:[Object(d.jsx)("h2",{"data-cy":"PostTitle",children:t.title}),Object(d.jsx)("p",{"data-cy":"PostBody",children:t.body})]}),Object(d.jsx)("div",{className:"block",children:c?Object(d.jsx)(r,{}):l?Object(d.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"}):0===s.length?Object(d.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("p",{className:"title is-4",children:"Comments:"}),s.map((e=>Object(d.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(d.jsxs)("div",{className:"message-header",children:[Object(d.jsx)("a",{href:"mailto:".concat(e.email),"data-cy":"CommentAuthor",children:e.name}),Object(d.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:()=>{p(e.id)},children:"delete button"})]}),Object(d.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)))]})}),!m&&Object(d.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:()=>b(!0),children:"Write a comment"}),m&&!l&&Object(d.jsx)(j,{handleCreateComment:async e=>{y(!0);try{const c=await(s={...e,postId:t.id},u("/comments",s));a((e=>[...e,c]))}catch{o(!0)}finally{y(!1)}var s},isCommentLoading:h})]})},N=e=>{let{users:t,selectedUser:s,setSelectedUser:a}=e;const[c,n]=Object(i.useState)(!1);return Object(d.jsxs)("div",{"data-cy":"UserSelector",className:l()("dropdown",{"is-active":c}),children:[Object(d.jsx)("div",{className:"dropdown-trigger",children:Object(d.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:()=>n(!c),onBlur:()=>n(!1),children:[s?Object(d.jsx)("span",{children:s.name}):Object(d.jsx)("span",{children:"Choose a user"}),Object(d.jsx)("span",{className:"icon is-small",children:Object(d.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(d.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:Object(d.jsx)("div",{className:"dropdown-content",children:t.map((e=>Object(d.jsx)("a",{href:"#user-".concat(e.id),className:l()("dropdown-item",{"is-active":(null===s||void 0===s?void 0:s.id)===e.id}),onMouseDown:()=>a(e),children:e.name},e.id)))})})]})},p=()=>{const[e,t]=Object(i.useState)([]),[s,a]=Object(i.useState)(null),[c,n]=Object(i.useState)([]),[j,m]=Object(i.useState)(!1),[b,h]=Object(i.useState)(!1),[u,x]=Object(i.useState)(null),p=async()=>{try{const e=await O("/users");t(e),h(!1)}catch{h(!0)}},v=Object(i.useCallback)((async()=>{if(s){m(!0);try{const t=await(e=null===s||void 0===s?void 0:s.id,O("/posts?userId=".concat(e)));n(t),h(!1)}catch{h(!0)}finally{m(!1)}}var e}),[s]);return Object(i.useEffect)((()=>{v(),x(null)}),[s,v]),Object(i.useEffect)((()=>{p()}),[]),Object(d.jsx)("main",{className:"section",children:Object(d.jsx)("div",{className:"container",children:Object(d.jsxs)("div",{className:"tile is-ancestor",children:[Object(d.jsx)("div",{className:"tile is-parent",children:Object(d.jsxs)("div",{className:"tile is-child box is-success",children:[Object(d.jsx)("div",{className:"block",children:Object(d.jsx)(N,{users:e,selectedUser:s,setSelectedUser:a})}),Object(d.jsxs)("div",{className:"block","data-cy":"MainContent",children:[j&&Object(d.jsx)(r,{}),!s&&Object(d.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),s&&!j&&Object(d.jsxs)(d.Fragment,{children:[b&&Object(d.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}),c.length>0?Object(d.jsx)(o,{posts:c,selectedPost:u,setSelectedPost:x}):Object(d.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"})]})]})]})}),Object(d.jsx)("div",{"data-cy":"Sidebar",className:l()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":u}),children:u&&Object(d.jsx)("div",{className:"tile is-child box is-success ",children:Object(d.jsx)(y,{post:u})})})]})})})};c.a.render(Object(d.jsx)(p,{}),document.getElementById("root"))}},[[14,1,2]]]);
//# sourceMappingURL=main.d4d0a53b.chunk.js.map